openapi: 3.0.0
info:
  version: 0.1.0
  title: Radix Babylon Gateway API
  license:
    name: The Radix License, Version 1.0
    url: https://www.radixfoundation.org/licenses/license-v1
  x-logo:
    url: https://docs.radixdlt.com/main/_images/radix-logo-banner.png
    href: https://docs.radixdlt.com
  description: | # TODO Add links to wallet once they get published
    This API is designed to enable clients to efficiently query information on the RadixDLT ledger,
    and allow clients to build and submit transactions to the network.
    It is designed for use by wallets and explorers.

    This document is an API reference documentation, visit [User Guide](https://docs.radixdlt.com/main/apis/gateway-api.html) to learn more about different usage scenarios.

    The Gateway API is implemented by the [Network Gateway](https://github.com/radixdlt/babylon-gateway),
    which is configured to read from [full node(s)](https://github.com/radixdlt/babylon-node) to extract
    and index data from the network.
servers: # TODO define mainnet / betanet endpoints?
  - url: https://betanet.radixdlt.com
  - url: http://localhost:5208
x-tagGroups:
  - name: Overview
    tags:
      - SubAPIs
      - Concepts
      - Architecture
  - name: Endpoints
    tags:
      - Status
      - Transaction
      - Stream
      - State
tags:
  - name: SubAPIs
    x-displayName: Sub-APIs
    x-traitTag: true
    description: |
      The Gateway API is split into 4 sub APIs:
      - **Status** (`/status/*`) - For status and configuration details for the Gateway / Network.
      - **Transaction** (`/transaction/*`) - For transaction construction, preview, submission, and monitoring the status of an individual transaction.
      - **Stream** (`/transaction/*`) - For reading committed transactions.
      - **State** (`/state/*`, `/entity/*` and `/non-fungible/*`) - For reading the current or past ledger state of the network.
  - name: Architecture
    x-traitTag: true
    description: |

      ## Request-Response Format

      The API is designed in a JSON-RPC-like style, using HTTP as a transport layer, which means that:
      - Requests always use HTTP POST method.
      - There is no HTTP cache involved.
      - Client-originated errors result in HTTP 4xx error responses.
      - Server-originated errors result in HTTP 5xx error responses:
          - The error object contains an HTTP-like `code`
          - The error object also contains a structured/typed properties, with a `type` discriminator, allowing for structured error interpretation in client software.

      ## Pagination Model

      Collections can grow in size therefore every dynamic-length collection is a subject to pagination where a generic data struct is used to represent a chunk (page) of
      underlying data. Gateway API uses cursor-based pagination model where the sole existence of the cursor indicates that next chunk (page) of the underlying collection is
      available.

      ```
      collection {
        int64? total_count,
        string? next_cursor,
        string? previous_cursor,
        T[] items
      }
      ```

      - `total_count` *(optional)* if present specifies the overall size of the underlying collection,
      - `next_cursor` *(optional)* if present indicates that the next chunk (page) exists and can be fetched using collection-specific endpoint and cursor value,
      - `previous_cursor` *(optional)* if present indicates that the previous chunk (page) exists and can be fetched using collection-specific endpoint and cursor value,
      - `items` a chunk (page) of unerlying collection items.
  - name: Concepts
    x-displayName: Concepts
    x-traitTag: true # Don't display endpoints under this tag
    description: |
      Interacting with this API effectively may require knowledge about the Radix Babylon Transaction Model and the State Model.

      We share some very high-level details below, but please see the [official documentation](http://docs.radixdlt.com) for more details on this.

      ## Transactions and the Gateway

      User transactions are formed of a core "intent", which is then signed by 0+ signatories, before being notarized. The output is called a notarized payload.
      It is this notarized transaction payload which is submitted to the network.

      For most users, this construction process will generally happen in their Radix Wallet. If you wish to construct transactions programmatically or offline,
      you will need to integrate the Radix Engine Toolkit into your application for construction and finalization.

      Once submitted, a transaction payload can end up being either rejected or committed. Transactions get rejected if they fail to pass certain criteria at the given time.
      A transaction payload can be marked as a:
      - **Permanent Rejection** if it is never possible for it to be committed (eg it's statically invalid, or only valid up until epoch 100 and it's now epoch 101)
      - **Temporary Rejection** if it still may be possible that the transaction payload could be committed

      A given intent typically is only part of one submitted notarized payload, but it's possible for a notary to notarize and submit multiple payloads for the same intent.
      The Radix Engine ensures that any intent can only be committed once.

      A committed transaction is either committed with an outcome of "Success" or "Failure":
      - **Committed Failure** will result in fees being paid up until the failure point, but all other changes will be discarded.
      - **Committed Success** will result in all changes being committed.

      Only committed transactions appear on ledger.

      The gateway will attempt to submit your transaction to nodes on the network.
      If it gets temporarily rejected, the error message will be recorded against the transaction, but the Gateway will
      retry submission for a limited time. During this time, the status will be reported as pending.

      ## State Model

      The Radix Engine consists of "global entities".
      A global entity has a Bech32m Address, with a human-readable-prefix (and prefix byte) matching the entity type.

      As an example, entities include concepts like Components, Packages, Vaults, Resource Managers and Key-Value Stores.

      Each entity owns substates which store data, and these substates can own other entities.
      For example, an Account Component has a struct substate which owns a Key-Value Store. This Key-Value store has an
      entry for each resoure the Account owns, and each Key-Value Store Entry owns a corresponding Vault.

      For each global entity, the Gateway aggregates its owned resources by looking at the contents of Vaults in the
      subtree of entities under that global entity.
  - name: Status
    x-displayName: Status Endpoints
    description: Query information about the Gateway API status.
  - name: Transaction
    x-displayName: Transaction Endpoints
    description: Query status of, construct, preview and submit transactions.
  - name: Stream
    x-displayName: Stream Endpoints
    description: Browse through the history of transactions.
  - name: State
    x-displayName: State Endpoints
    description: Query information snapshot about state of ledger entities at present or past time.
paths:
  "/gateway/information":
    post:
      operationId: GatewayInformation
      summary: Get Gateway Information
      description: |
        Returns the Gateway API version, current ledger state and well-known network addresses.
      tags:
        - Status
      responses:
        "200":
          description: Network Gateway Information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GatewayInformationResponse"

  "/transaction/recent":
    post:
      operationId: TransactionRecent
      summary: Get Recent Transactions
      description: |
        Returns user-initiated transactions which have been committed to the ledger.
        The returned response is in a paginated format, ordered by most recently committed.
      tags:
        - Stream
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionRecentRequest"
      responses:
        "200":
          description: Recent Transactions (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionRecentResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"

  "/transaction/construction":
    post:
      operationId: TransactionConstruction
      summary: Get Construction Metadata
      description: |
        Returns information needed to construct a new transaction including current `epoch` number.
      tags:
        - Transaction
      responses:
        "200":
          description: |
            Returns information needed to construct transaction.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionConstructionResponse"
  "/transaction/preview":
    post:
      operationId: TransactionPreview
      summary: Preview Transaction
      description: |
        Previews transaction against the network.
        This endpoint is effectively a proxy towards CoreApi's `/v0/transaction/preview` endpoint. See CoreApi's documentation for more details.
      tags:
        - Transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              description: Refer to `#/components/schemas/TransactionPreviewRequest` of CoreApi for more details.
              type: object
      responses:
        "200":
          description: Successful Preview
          content:
            application/json:
              schema:
                description: Refer to `#/components/schemas/TransactionPreviewResponse` of CoreApi for more details.
                type: object
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  "/transaction/submit":
    post:
      operationId: TransactionSubmit
      summary: Submit Transaction
      description: |
        Submits a signed transaction payload to the network.
      tags:
        - Transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionSubmitRequest"
      responses:
        "200":
          description: Successful Submission
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionSubmitResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  "/transaction/committed-details":
    post:
      operationId: TransactionCommittedDetails
      summary: Get Committed Transaction Details
      description: |
        Returns the committed details and receipt of the transaction for a given transaction identifier.
        Transaction identifiers which don't correspond to a committed transaction will return a `TransactionNotFoundError`.
      tags:
        - Transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionCommittedDetailsRequest"
      responses:
        "200":
          description: Transaction Status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionCommittedDetailsResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  "/transaction/status":
    post:
      operationId: TransactionStatus
      summary: Get Transaction Status
      description: |
        Returns overall transaction status and all of its known payloads based on supplied intent hash.
      tags:
        - Transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransactionStatusRequest"
      responses:
        "200":
          description: Transaction Status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TransactionStatusResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"

  /entity/overview:
    post:
      operationId: EntityOverview
      summary: Get Entities Overview
      description: |
        Returns basic information (incomplete metadata) for a given collection of entities.
        This endpoint is intended to be used for populating screens which contain a small bit of information about
        multiple entities.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityOverviewRequest"
      responses:
        "200":
          description: Entities Overview
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityOverviewResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/details:
    post:
      operationId: EntityDetails
      summary: Get Entity Details
      description: |
        Returns detailed information for a single entity.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityDetailsRequest"
      responses:
        "200":
          description: Entity Details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityDetailsResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/resources:
    post:
      operationId: EntityResources
      summary: Get Entity Resource Totals
      description: |
        Returns the total amount of each fungible and non-fungible resources owned by a given global entity.
        The response for fungibles and non-fungibles is paginated, and only the first page of each is returned.
        The returned lists are ordered by the resource's first appearance on the ledger.
        For further pages, use the `entity/fungibles` and `entity/non-fungibles` endpoints.
        To get the owned non-fungible ids (instead of just the amount), use the `entity/non-fungible-ids` endpoint.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityResourcesRequest"
      responses:
        "200":
          description: Entity Resources
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityResourcesResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/metadata:
    post:
      operationId: EntityMetadata
      summary: Get Entity Metadata
      description: |
        Returns all the metadata properties associated with a given global entity.
        The returned response is in a paginated format, ordered by first appearance on the ledger.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityMetadataRequest"
      responses:
        "200":
          description: Entity Metadata (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityMetadataResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/fungibles:
    post:
      operationId: EntityFungibles
      summary: Get Entity Fungible Resource Totals
      description: |
        Returns the total amount of each fungible resource owned by a given global entity.
        The returned response is in a paginated format, ordered by the resource's first appearance on the ledger.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityFungiblesRequest"
      responses:
        "200":
          description: Entity Fungibles (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityFungiblesResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/non-fungibles:
    post:
      operationId: EntityNonFungibles
      summary: Get Entity Non-Fungible Resource Totals
      description: |
        Returns the total amount of each non-fungible resource owned by a given global entity.
        The returned response is in a paginated format, ordered by the resource's first appearance on the ledger.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityNonFungiblesRequest"
      responses:
        "200":
          description: Entity Non-Fungibles (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityNonFungiblesResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /entity/non-fungible/ids:
    post:
      operationId: EntityNonFungibleIds
      #### TODO: CONTINUE FROM HERE WITH ADDING GET AND FIXING THE DESCRIPTIONS
      summary: Get Entity Non-Fungible IDs
      description: |
        Returns all non-fungible IDs of a given non-fungible resource owned by a given entity.
        The returned response is in a paginated format, ordered by the resource's first appearence on the ledger.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EntityNonFungibleIdsRequest"
      responses:
        "200":
          description: Entity Non-Fungible IDs (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EntityNonFungibleIdsResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"

  /non-fungible/ids:
    post:
      operationId: NonFungibleIds
      summary: Get Non-Fungible Collection
      description: |
        Returns the non-fungible IDs of a given non-fungible resource.
        Returned response is in a paginated format, ordered by their first appearance on the ledger.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NonFungibleIdsRequest"
      responses:
        "200":
          description: Non-Fungible IDs (paginated)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NonFungibleIdsResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"
  /non-fungible/data:
    post:
      operationId: NonFungibleIdData
      summary: Get Non-Fungible Data
      description: |
        Returns data associated with a given non-fungible ID of a given non-fungible resource.
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NonFungibleDataRequest"
      responses:
        "200":
          description: Non-Fungible ID Data
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NonFungibleDataResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"

  /state/validators/list:
    post:
      operationId: StateValidatorsList
      summary: Get Validators List
      tags:
        - State
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StateValidatorsListRequest"
      responses:
        "200":
          description: Validators List
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StateValidatorsListResponse"
        "4XX":
          $ref: "#/components/responses/ErrorResponse"

components:
  responses:
    ErrorResponse:
      description: Client-originated request error
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:

    #
    # Aliases
    #

    EntityAddress:
      description: Bech32m-encoded human readable version of the entity's global address.
      type: string
    ComponentAddress:
      description: Bech32m-encoded human readable version of the component (normal, account, system) global address.
      type: string
    ResourceAddress:
      description: Bech32m-encoded human readable version of the resource (fungible, non-fungible) global address.
      type: string

    BigDecimal:
      description: String-encoded decimal representing the amount of a related fungible resource.
      type: string

    NonFungibleId:
      description: String-encoded non-fungible ID.
      type: string

    HashHexString:
      description: Hex-encoded SHA-256 hash.
      type: string
    HexString:
      description: Hex-encoded binary blob.
      type: string
    NotarizedTransactionHexString:
      description: Hex-encoded notarized transaction payload which can be submitted.
      type: string

    AccessRulesChain:
      description: Refer to `#/components/schemas/AccessRules` of CoreApi for more details.
      type: object

    #
    # Keys
    #
    PublicKeyType:
      type: string
      enum:
        - EcdsaSecp256k1
        - EddsaEd25519
    PublicKey:
      type: object
      required:
        - key_type
      properties:
        key_type:
          $ref: "#/components/schemas/PublicKeyType"
      discriminator:
        propertyName: key_type
        mapping:
          # NOTE: These need to match PublicKeyType
          EcdsaSecp256k1: "#/components/schemas/PublicKeyEcdsaSecp256k1"
          EddsaEd25519: "#/components/schemas/PublicKeyEddsaEd25519"
    PublicKeyEcdsaSecp256k1:
      allOf:
        - $ref: "#/components/schemas/PublicKey"
        - type: object
          required:
            - key_hex
          properties:
            key_hex:
              type: string
              minLength: 66
              maxLength: 66
              description: The hex-encoded compressed ECDSA Secp256k1 public key (33 bytes)
    PublicKeyEddsaEd25519:
      allOf:
        - $ref: "#/components/schemas/PublicKey"
        - type: object
          required:
            - key_hex
          properties:
            key_hex:
              type: string
              minLength: 64
              maxLength: 64
              description: The hex-encoded compressed EdDSA Ed25519 public key (32 bytes)

    #
    # Common Request Types
    #

    AtLedgerStateMixin:
      type: object
      properties:
        at_ledger_state:
          $ref: "#/components/schemas/LedgerStateSelector"

    LedgerStateSelector:
      description: |
        Optional. This allows for a request to be made against a historic state.
        If a constraint is specified, the Gateway will resolve the request against the ledger state at that time.
        If not specified, requests will be made with respect to the top of the committed ledger.
      type: object
      nullable: true
      properties:
        state_version:
          description: If provided, the latest ledger state lower than or equal to the given state version is returned.
          nullable: true
          type: integer
          format: int64
        timestamp:
          description: If provided, the latest ledger state lower than or equal to the given round timestamp is returned.
          nullable: true
          type: string
          format: date-time
        epoch:
          description: If provided, the ledger state lower than or equal to the given epoch at round 0 is returned.
          nullable: true
          type: integer
          format: int64
        round:
          description: If provided must be accompanied with `epoch`, the ledger state lower than or equal to the given epoch and round is returned.
          nullable: true
          type: integer
          format: int64

    #
    # Common Response Types
    #

    LedgerStateMixin:
      type: object
      required:
        - ledger_state
      properties:
        ledger_state:
          $ref: "#/components/schemas/LedgerState"
    ResultSetCursorMixin:
      type: object
      properties:
        total_count:
          description: Total number of items in underlying collection, fragment of which is available in `items` collection.
          type: integer
          format: int64
          nullable: true
        previous_cursor:
          description: If specified, contains a cursor to query previous page of the `items` collection.
          type: string
          nullable: true
        next_cursor:
          description: If specified, contains a cursor to query next page of the `items` collection.
          type: string
          nullable: true

    LedgerState:
      description: |
        The ledger state against which the response was generated.
        Can be used to detect if the Network Gateway is returning up-to-date information.
      type: object
      required:
        - network
        - state_version
        - proposer_round_timestamp
        - epoch
        - round
      properties:
        network:
          description: The name of the network against which the request is made.
          type: string
        state_version:
          description: The state version of the ledger. Each transaction increments the state version by 1.
          type: integer
          format: int64
        proposer_round_timestamp:
          description: |
            The proposer round timestamp of the consensus round when this transaction was committed to ledger.
            This is not guaranteed to be strictly increasing, as it is computed as an average across the validator set.
            If this is significantly behind the current timestamp, the Network Gateway is likely reporting out-dated
            information, or the network has stalled.
          type: string
          # TODO add format: date-time once OAS generator get fixed support for required value-types
        epoch:
          description: The epoch number of the ledger at this state version.
          type: integer
          format: int64
        round:
          description: The consensus round in the epoch that this state version was committed in.
          type: integer
          format: int64

    EntityMetadataCollection:
      description: Entity metadata collection.
      allOf:
        - $ref: "#/components/schemas/ResultSetCursorMixin"
        - type: object
          required:
            - items
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/EntityMetadataItem"
    EntityMetadataItem:
      description: Entity metadata key-value pair.
      type: object
      required:
        - key
        - value
      properties:
        key:
          description: Entity metadata key.
          type: string
        value:
          description: Entity metadata value.
          type: string

    FungibleResourcesCollection:
      description: Fungible resources collection.
      allOf:
        - $ref: "#/components/schemas/ResultSetCursorMixin"
        - type: object
          required:
            - items
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/FungibleResourcesCollectionItem"
    FungibleResourcesCollectionItem:
      type: object
      required:
        - address
        - amount
      properties:
        address:
          $ref: "#/components/schemas/ResourceAddress"
        amount:
          $ref: "#/components/schemas/TokenAmount"
    NonFungibleResourcesCollection:
      description: Non-fungible resources collection.
      allOf:
        - $ref: "#/components/schemas/ResultSetCursorMixin"
        - type: object
          required:
            - items
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/NonFungibleResourcesCollectionItem"
    NonFungibleResourcesCollectionItem:
      type: object
      required:
        - address
        - amount
      properties:
        address:
          $ref: "#/components/schemas/ResourceAddress"
        amount:
          type: integer
          format: int64
    NonFungibleIdsCollection:
      description: Non-fungible resource IDs collection.
      allOf:
        - $ref: "#/components/schemas/ResultSetCursorMixin"
        - type: object
          required:
            - items
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/NonFungibleIdsCollectionItem"
    NonFungibleIdsCollectionItem:
      type: object
      required:
        - non_fungible_id
      properties:
        non_fungible_id:
          $ref: "#/components/schemas/NonFungibleId"

    CommittedTransactionInfo:
      type: object
      required:
        - state_version
        - transaction_status
        - payload_hash_hex
        - intent_hash_hex
      properties:
        state_version:
          nullable: true
          type: integer
          format: int64
        transaction_status:
          $ref: "#/components/schemas/TransactionStatus"
        payload_hash_hex:
          $ref: "#/components/schemas/HashHexString"
        intent_hash_hex:
          $ref: "#/components/schemas/HashHexString"
        fee_paid:
          $ref: "#/components/schemas/TokenAmount"
        confirmed_at:
          nullable: true
          type: string
          format: date-time
        error_message:
          type: string
          nullable: true

    TransactionStatus:
      type: string
      enum:
        - unknown
        - committed_success
        - committed_failure
        - pending
        - rejected

    TokenAmount:
      description: Represents a decimal amount of a given resource.
      type: object
      required:
        - value
        - token_identifier
      properties:
        value:
          $ref: "#/components/schemas/BigDecimal"
        address:
          $ref: "#/components/schemas/ResourceAddress"

    NonFungibleIdType:
      type: string
      enum:
        - string
        - number
        - bytes
        - uuid

    ValidatorCollection:
      allOf:
        - $ref: "#/components/schemas/ResultSetCursorMixin"
        - type: object
          required:
            - items
          properties:
            items:
              type: array
              items:
                $ref: "#/components/schemas/ValidatorCollectionItem"
    ValidatorCollectionItem:
      type: object
      required:
        - address
        - metadata
      properties:
        address:
          $ref: "#/components/schemas/EntityAddress"
        state:
          type: object
          nullable: true
        active_in_epoch:
          $ref: "#/components/schemas/ValidatorCollectionItemActiveInEpoch"
        metadata:
          $ref: "#/components/schemas/EntityMetadataCollection"
    ValidatorCollectionItemActiveInEpoch:
      type: object
      required:
        - stake
        - key
      properties:
        stake:
          $ref: "#/components/schemas/ValidatorCollectionItemActiveInEpochStake"
        key:
          $ref: "#/components/schemas/PublicKey"
        metadata:
          $ref: "#/components/schemas/EntityMetadataCollection"
    ValidatorCollectionItemActiveInEpochStake:
      type: object
      required:
        - stake
        - stake_percentage
      properties:
        stake:
          $ref: "#/components/schemas/TokenAmount"
        stake_percentage:
          type: number
          format: double

    #
    # /gateway/* Request & Response Types
    #

    GatewayInformationResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - known_target
            - release_info
            - well_known_addresses
          properties:
            known_target:
              $ref: "#/components/schemas/GatewayInfoResponseKnownTarget"
            release_info:
              $ref: "#/components/schemas/GatewayInfoResponseReleaseInfo"
            well_known_addresses:
              type: object
              required:
                - account_package
                - faucet
                - epoch_manager
                - clock
                - ecdsa_secp256k1
                - eddsa_ed25519
                - xrd
              properties:
                account_package:
                  $ref: "#/components/schemas/EntityAddress"
                faucet:
                  $ref: "#/components/schemas/ComponentAddress"
                epoch_manager:
                  $ref: "#/components/schemas/EntityAddress"
                clock:
                  $ref: "#/components/schemas/EntityAddress"
                ecdsa_secp256k1:
                  $ref: "#/components/schemas/ResourceAddress"
                eddsa_ed25519:
                  $ref: "#/components/schemas/ResourceAddress"
                xrd:
                  $ref: "#/components/schemas/ResourceAddress"
    GatewayInfoResponseKnownTarget:
      type: object
      required:
        - state_version
      properties:
        state_version:
          description: |
            The latest-seen state version of the tip of the network's ledger. If this is significantly ahead of the current ledger state version, the Network Gateway is possibly behind and may be reporting outdated information.
          type: integer
          format: int64
    GatewayInfoResponseReleaseInfo:
      type: object
      required:
        - release_version
        - open_api_schema_version
      properties:
        release_version:
          description: The release that is currently deployed to the Gateway API.
          type: string
        open_api_schema_version:
          description: The Open API Schema version that was used to generate the API models.
          type: string

    #
    # /transaction/* Request & Response Types
    #

    TransactionConstructionResponse:
      allOf:
        - type: object
        - $ref: "#/components/schemas/LedgerStateMixin"
    TransactionRecentRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          properties:
            from_ledger_state:
              $ref: "#/components/schemas/LedgerStateSelector"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        limit: 5
    TransactionRecentResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - allOf:
            - $ref: "#/components/schemas/ResultSetCursorMixin"
            - type: object
              required:
                - items
              properties:
                items:
                  description: The page of user transactions.
                  type: array
                  items:
                    $ref: "#/components/schemas/CommittedTransactionInfo"

    TransactionSubmitRequest:
      type: object
      required:
        - notarized_transaction_hex
      properties:
        notarized_transaction_hex:
          $ref: "#/components/schemas/NotarizedTransactionHexString"
    TransactionSubmitResponse:
      type: object
      required:
        - duplicate
      properties:
        duplicate:
          type: boolean
          description: Is true if the transaction is a duplicate of an existing pending transaction.

    TransactionStatusRequest:
      allOf:
        - type: object
          required:
            - intent_hash_hex
          properties:
            intent_hash_hex:
              $ref: "#/components/schemas/HashHexString"
      example:
        intent_hash_hex: "<transaction-intent-hash>"
    TransactionStatusResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - status
            - known_payloads
          properties:
            status:
              $ref: "#/components/schemas/TransactionStatus"
            known_payloads:
              type: array
              items:
                $ref: "#/components/schemas/TransactionStatusResponseKnownPayloadItem"
            error_message:
              type: string
              nullable: true
    TransactionStatusResponseKnownPayloadItem:
      type: object
      required:
        - payload_hash_hex
        - status
      properties:
        payload_hash_hex:
          $ref: "#/components/schemas/HashHexString"
        status:
          $ref: "#/components/schemas/TransactionStatus"
        error_message:
          type: string
          nullable: true

    TransactionCommittedDetailsRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - transaction_identifier
          properties:
            transaction_identifier:
              $ref: "#/components/schemas/TransactionCommittedDetailsRequestIdentifier"
      example:
        transaction_identifier:
          type: payload_hash
          value_hex: "<transaction-payload-hash>"
    TransactionCommittedDetailsRequestIdentifierType:
      type: string
      enum:
        - intent_hash
        - signed_intent_hash
        - payload_hash
    TransactionCommittedDetailsRequestIdentifier:
      type: object
      required:
        - type
        - value_hex
      properties:
        type:
          $ref: "#/components/schemas/TransactionCommittedDetailsRequestIdentifierType"
        value_hex:
          $ref: "#/components/schemas/HexString"
    TransactionCommittedDetailsResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - transaction
            - details
          properties:
            transaction:
              $ref: "#/components/schemas/CommittedTransactionInfo"
            details:
              $ref: "#/components/schemas/TransactionCommittedDetailsResponseDetails"
    TransactionCommittedDetailsResponseDetails:
      type: object
      required:
        - raw_hex
        - receipt
        - referenced_global_entities
      properties:
        raw_hex:
          $ref: "#/components/schemas/HexString"
        receipt:
          type: object
        referenced_global_entities:
          type: array
          items:
            type: string
        message_hex:
          $ref: "#/components/schemas/HexString"

    #
    # /entity/* Request & Response Types
    #

    EntityResourcesRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
      example:
        address: "<component-entity-address>"
    EntityResourcesResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - fungible_resources
            - non_fungible_resources
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            fungible_resources:
              $ref: "#/components/schemas/FungibleResourcesCollection"
            non_fungible_resources:
              $ref: "#/components/schemas/NonFungibleResourcesCollection"

    EntityDetailsRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
      example:
        address: "<entity-address>"
    EntityDetailsResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - metadata
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            metadata:
              $ref: "#/components/schemas/EntityMetadataCollection"
            details:
              $ref: "#/components/schemas/EntityDetailsResponseDetails"
    EntityDetailsResponseDetailsType:
      type: string
      enum:
        - fungible_resource
        - non_fungible_resource
        - package
        - component
    EntityDetailsResponseDetails:
      oneOf:
        - $ref: "#/components/schemas/EntityDetailsResponseFungibleResourceDetails"
        - $ref: "#/components/schemas/EntityDetailsResponseNonFungibleResourceDetails"
        - $ref: "#/components/schemas/EntityDetailsResponsePackageDetails"
        - $ref: "#/components/schemas/EntityDetailsResponseComponentDetails"
      discriminator:
        propertyName: discriminator
        mapping:
          # Must match EntityDetailsResponseDetailsType
          fungible_resource: "#/components/schemas/EntityDetailsResponseFungibleResourceDetails"
          non_fungible_resource: "#/components/schemas/EntityDetailsResponseNonFungibleResourceDetails"
          package: "#/components/schemas/EntityDetailsResponsePackageDetails"
          component: "#/components/schemas/EntityDetailsResponseComponentDetails"
    EntityDetailsResponseFungibleResourceDetails:
      type: object
      required:
        - discriminator
        - access_rules_chain
        - vault_access_rules_chain
        - divisibility
        - total_supply
        - total_minted
        - total_burnt
      properties:
        discriminator:
          $ref: "#/components/schemas/EntityDetailsResponseDetailsType"
        access_rules_chain:
          type: object
        vault_access_rules_chain:
          type: object
        divisibility:
          type: integer
          minimum: 0
        total_supply:
          $ref: "#/components/schemas/BigDecimal"
        total_minted:
          $ref: "#/components/schemas/BigDecimal"
        total_burnt:
          $ref: "#/components/schemas/BigDecimal"
    EntityDetailsResponseNonFungibleResourceDetails:
      type: object
      required:
        - discriminator
        - access_rules_chain
        - vault_access_rules_chain
        - non_fungible_id_type
      properties:
        discriminator:
          $ref: "#/components/schemas/EntityDetailsResponseDetailsType"
        access_rules_chain:
          type: object
        vault_access_rules_chain:
          type: object
        non_fungible_id_type:
          $ref: "#/components/schemas/NonFungibleIdType"
    EntityDetailsResponsePackageDetails:
      type: object
      required:
        - discriminator
        - code_hex
      properties:
        discriminator:
          $ref: "#/components/schemas/EntityDetailsResponseDetailsType"
        code_hex:
          $ref: "#/components/schemas/HexString"
    EntityDetailsResponseComponentDetails:
      type: object
      required:
        - discriminator
        - package_address
        - blueprint_name
        - state
        - access_rules_chain
      properties:
        discriminator:
          $ref: "#/components/schemas/EntityDetailsResponseDetailsType"
        package_address:
          $ref: "#/components/schemas/EntityAddress"
        blueprint_name:
          type: string
        state:
          type: object
        access_rules_chain:
          type: object

    EntityOverviewRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - addresses
          properties:
            addresses:
              type: array
              items:
                $ref: "#/components/schemas/EntityAddress"
      example:
        addresses:
          - "<entity-address>"
    EntityOverviewResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - entities
          properties:
            entities:
              type: array
              items:
                $ref: "#/components/schemas/EntityOverviewResponseEntityItem"
    EntityOverviewResponseEntityItem:
       type: object
       required:
         - address
         - metadata
       properties:
         address:
           $ref: "#/components/schemas/EntityAddress"
         metadata:
           $ref: "#/components/schemas/EntityMetadataCollection"

    EntityMetadataRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<entity-address>"
    EntityMetadataResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - metadata
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            metadata:
              $ref: "#/components/schemas/EntityMetadataCollection"

    EntityFungiblesRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<component-entity-address>"
    EntityFungiblesResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - fungibles
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            fungibles:
              $ref: "#/components/schemas/FungibleResourcesCollection"

    EntityNonFungiblesRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<component-entity-address>"
    EntityNonFungiblesResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - non_fungibles
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            non_fungibles:
              $ref: "#/components/schemas/NonFungibleResourcesCollection"

    EntityNonFungibleIdsRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            resource_address:
              $ref: "#/components/schemas/ResourceAddress"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<component-entity-address>"
        resource_address: "<non-fungible-resource-entity-address>"
    EntityNonFungibleIdsResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - resource_address
            - non_fungible_ids
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            resource_address:
              $ref: "#/components/schemas/ResourceAddress"
            non_fungible_ids:
              $ref: "#/components/schemas/NonFungibleIdsCollection"

    NonFungibleIdsRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<non-fungible-entity-address>"
    NonFungibleIdsResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - non_fungible_ids
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            non_fungible_ids:
              $ref: "#/components/schemas/NonFungibleIdsCollection"

    NonFungibleDataRequest: # TODO rename to NonFungibleIdDataRequest
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          required:
            - address
            - non_fungible_id
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
            non_fungible_id:
              $ref: "#/components/schemas/NonFungibleId"
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
            limit:
              description: The page size requested.
              type: integer
              nullable: true
      example:
        address: "<non-fungible-entity-address>"
        non_fungible_id: "0a0100000000"
    NonFungibleDataResponse: # TODO rename to NonFungibleIdDataResponse
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - address
            - non_fungible_id_type
            - non_fungible_id
            - mutable_data_hex
            - immutable_data_hex
          properties:
            address:
              $ref: "#/components/schemas/ResourceAddress"
            non_fungible_id_type:
              $ref: "#/components/schemas/NonFungibleIdType"
            non_fungible_id:
              $ref: "#/components/schemas/NonFungibleId"
            mutable_data_hex:
              $ref: "#/components/schemas/HexString"
            immutable_data_hex:
              $ref: "#/components/schemas/HexString"

    #
    # /state/validators/* Request & Response Types
    #

    StateValidatorsListRequest:
      allOf:
        - $ref: "#/components/schemas/AtLedgerStateMixin"
        - type: object
          properties:
            cursor:
              description: This cursor allows forward pagination, by providing the cursor from the previous request.
              type: string
              nullable: true
      example:
        at_ledger_state: null
    StateValidatorsListResponse:
      allOf:
        - $ref: "#/components/schemas/LedgerStateMixin"
        - type: object
          required:
            - validators
          properties:
            validators:
              $ref: "#/components/schemas/ValidatorCollection"

    #
    # Errors
    #

    ErrorResponse:
      type: object
      required:
        - message
      properties:
        message:
          description: A human-readable error message.
          type: string
        code:
          description: A numeric code corresponding to the given error type.
          type: integer
        details:
          $ref: "#/components/schemas/GatewayError"
        trace_id:
          description: A unique request identifier to be used when reporting errors, to allow correlation with the Gateway API's error logs.
          type: string

    GatewayError:
      type: object
      required:
        - type
      properties:
        type:
          description: The type of error. Each subtype may have its own additional structured fields.
          type: string
      discriminator:
        propertyName: type
        mapping:
          EntityNotFoundError: "#/components/schemas/EntityNotFoundError"
          InvalidEntityError: "#/components/schemas/InvalidEntityError"
          NotSyncedUpError: "#/components/schemas/NotSyncedUpError"
          InvalidRequestError: "#/components/schemas/InvalidRequestError"
          InvalidTransactionError: "#/components/schemas/InvalidTransactionError"
          TransactionNotFoundError: "#/components/schemas/TransactionNotFoundError"
          InternalServerError: "#/components/schemas/InternalServerError"
    EntityNotFoundError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
    InvalidEntityError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - address
          properties:
            address:
              $ref: "#/components/schemas/EntityAddress"
    NotSyncedUpError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - request_type
            - current_sync_delay_seconds
            - max_allowed_sync_delay_seconds
          properties:
            request_type:
              description: The request type that triggered this exception.
              type: string
            current_sync_delay_seconds:
              description: The current delay between the Gateway DB and the network ledger round timestamp.
              type: integer
              format: int64
            max_allowed_sync_delay_seconds:
              description: The maximum allowed delay between the Gateway DB and the network ledger round timestamp for this `request_type`.
              type: integer
              format: int64
    InvalidRequestError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - validation_errors
          properties:
            validation_errors:
              description: One or more validation errors which occurred when validating the request.
              type: array
              items:
                $ref: "#/components/schemas/ValidationErrorsAtPath"
    InvalidTransactionError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
    TransactionNotFoundError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - transaction_not_found
          properties:
            transaction_not_found:
              $ref: "#/components/schemas/TransactionCommittedDetailsRequestIdentifier"
    InternalServerError:
      allOf:
        - $ref: "#/components/schemas/GatewayError"
        - type: object
          required:
            - exception
            - cause
          properties:
            exception:
              description: Gives an error type which occurred within the Gateway API when serving the request.
              type: string
            cause:
              description: Gives a human readable message - likely just a trace ID for reporting the error.
              type: string
    ValidationErrorsAtPath:
      type: object
      required:
        - path
        - errors
      properties:
        path:
          type: string
        errors:
          type: array
          items:
            type: string
